<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Browser Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --chat-bg: #ffffff;
            --user-bubble: #e3f2fd;
            --ai-bubble: #f1f1f1;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --sidebar-width: 280px;
            --header-height: 60px;
            --input-height: 80px;
            --link-color: #000000;
        }

        [data-theme="dark"] {
            --primary-color: #4895ef;
            --secondary-color: #4361ee;
            --text-color: #f8f9fa;
            --bg-color: #121212;
            --chat-bg: #1e1e1e;
            --user-bubble: #2a3f5f;
            --ai-bubble: #333333;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --link-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            touch-action: manipulation;
        }

        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--chat-bg);
            padding: 15px;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 100;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            will-change: transform;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-top: 10px;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .api-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }

        .api-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .setting-option {
            margin-bottom: 15px;
        }

        .setting-option label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .setting-option select, .setting-option input {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: var(--chat-bg);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        /* Overlay for mobile */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .sidebar-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
        }

        .app-header {
            padding: 0 15px;
            height: var(--header-height);
            min-height: var(--header-height);
            background-color: var(--chat-bg);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .app-header h1 {
            font-size: 1.2rem;
            color: var(--primary-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60%;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 1rem;
            padding: 8px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            min-width: 40px;
            height: 40px;
        }

        .icon-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            height: calc(100% - var(--header-height));
            position: relative;
        }

        .chat-history {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            padding-bottom: 20px;
        }

        .message {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            font-size: 0.95rem;
            word-wrap: break-word;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--user-bubble);
            color: var(--text-color);
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            align-self: flex-start;
            background-color: var(--ai-bubble);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
        }

        .typing-indicator {
            display: inline-block;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: var(--text-color);
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
            animation: bounce 1.5s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .input-area {
            padding: 10px 15px;
            background-color: var(--chat-bg);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            min-height: var(--input-height);
        }

        .input-container {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        #user-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-size: 0.95rem;
            background-color: var(--chat-bg);
            color: var(--text-color);
            outline: none;
            transition: border-color 0.3s;
            min-height: 45px;
            max-height: 120px;
            resize: none;
            line-height: 1.4;
        }

        #user-input:focus {
            border-color: var(--primary-color);
        }

        .disclaimer {
            font-size: 0.7rem;
            color: #777;
            text-align: center;
            line-height: 1.3;
        }

        /* Markdown-like styles for AI responses */
        .ai-message pre {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 8px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 8px 0;
            font-size: 0.85rem;
        }

        .ai-message code {
            font-family: monospace;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.85rem;
        }

        .ai-message strong {
            font-weight: bold;
        }

        .ai-message em {
            font-style: italic;
        }

        .ai-message ul, .ai-message ol {
            margin-left: 18px;
            margin-bottom: 8px;
        }

        .ai-message li {
            margin-bottom: 4px;
        }

        /* Link styles */
        .ai-message a {
            color: var(--link-color);
            text-decoration: underline;
        }

        /* Weather widget styles */
        .weather-widget {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .weather-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        .weather-icon {
            width: 50px;
            height: 50px;
        }
        .weather-temp {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        .weather-detail {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        /* Responsive Styles */
        @media (min-width: 768px) {
            :root {
                --sidebar-width: 300px;
                --header-height: 70px;
            }

            .sidebar {
                position: relative;
                transform: translateX(0);
            }

            .sidebar-overlay {
                display: none;
            }

            .app-header h1 {
                font-size: 1.3rem;
            }

            .message {
                max-width: 75%;
                padding: 12px 16px;
                font-size: 1rem;
            }

            #user-input {
                font-size: 1rem;
            }
        }

        @media (min-width: 992px) {
            :root {
                --sidebar-width: 320px;
            }

            .message {
                max-width: 70%;
            }
        }

        /* Very small devices (phones, 400px and down) */
        @media (max-width: 400px) {
            :root {
                --sidebar-width: 260px;
                --header-height: 55px;
            }

            .app-header h1 {
                font-size: 1.1rem;
                max-width: 50%;
            }

            .message {
                max-width: 90%;
                font-size: 0.9rem;
                padding: 8px 12px;
            }

            #user-input {
                font-size: 0.9rem;
                padding: 8px 12px;
            }
        }

        /* Tablet landscape */
        @media (min-width: 768px) and (orientation: landscape) {
            :root {
                --header-height: 60px;
                --input-height: 70px;
            }
        }

        /* Large desktop screens */
        @media (min-width: 1200px) {
            :root {
                --sidebar-width: 350px;
            }
        }

        /* Prevent zoom on input focus in mobile */
        @media (max-width: 768px) {
            input, textarea {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Settings</h3>
            </div>
            
            <div class="api-selector">
                <h3>Knowledge Sources</h3>
                <div class="api-options">
                    <label><input type="checkbox" name="api" value="wikipedia" checked> Wikipedia</label>
                    <label><input type="checkbox" name="api" value="news" checked> News API</label>
                    <label><input type="checkbox" name="api" value="weather" checked> Weather API</label>
                    <label><input type="checkbox" name="api" value="maps" checked> Maps API</label>
                    <label><input type="checkbox" name="api" value="browser" checked> Browser Search</label>
                </div>
            </div>
            
            <div class="settings">
                <h3>Preferences</h3>
                <div class="setting-option">
                    <label for="theme">Theme:</label>
                    <select id="theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="system">System</option>
                    </select>
                </div>
                <div class="setting-option">
                    <label for="voice-enabled">Voice Input:</label>
                    <select id="voice-enabled">
                        <option value="enabled">Enabled</option>
                        <option value="disabled">Disabled</option>
                    </select>
                </div>
            </div>
        </aside>

        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <div class="main-content">
            <header class="app-header">
                <button class="icon-btn" id="menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>AI Browser Assistant</h1>
                <button id="new-chat-btn" class="icon-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </header>
            
            <div class="chat-container">
                <div class="chat-history" id="chat-history">
                    <!-- Messages will appear here -->
                </div>
                
                <div class="input-area">
                    <div class="input-container">
                        <textarea id="user-input" placeholder="Ask me anything..." rows="1"></textarea>
                        <button id="send-btn" class="icon-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                        <button id="voice-btn" class="icon-btn">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="disclaimer">
                        <p>This AI uses public APIs and browser capabilities to answer questions.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const chatHistory = document.getElementById('chat-history');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const voiceBtn = document.getElementById('voice-btn');
            const newChatBtn = document.getElementById('new-chat-btn');
            const themeSelect = document.getElementById('theme');
            const voiceSelect = document.getElementById('voice-enabled');
            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            // State
            let currentChat = [];
            let recognition = null;
            let isSidebarOpen = false;
            
            // API Keys 
            const API_KEYS = {
                NEWS: 'pub_976ec11944b142b7ad92f49c39c8d083', // NewsData.io API key (free tier)
                WEATHER: '7aeb3684231dace95f847e71f9b474b0' // OpenWeatherMap API key
            };
            
            // Comprehensive list of general questions and responses
            const GENERAL_QUESTIONS = {
                // Greetings
                greetings: {
                    patterns: [
                        /^hi\b/i, /^hello\b/i, /^hey\b/i, /^greetings\b/i, 
                        /^good\s(morning|afternoon|evening)\b/i, /^what's\sup\b/i,
                        /^howdy\b/i, /^yo\b/i, /^hi\sthere\b/i, /^hello\sthere\b/i,
                        /^hiya\b/i, /^heya\b/i, /^ahoy\b/i, /^hola\b/i, /^bonjour\b/i,
                        /^ciao\b/i, /^namaste\b/i, /^salut\b/i, /^g'day\b/i, /^sup\b/i
                    ],
                    responses: [
                        "Hello! How can I assist you today?",
                        "Hi there! What can I do for you?",
                        "Greetings! How may I help you?",
                        "Good day! What would you like to know?",
                        "Hello! I'm here to help. What's on your mind?",
                        "Hi! Ready to assist you with anything you need.",
                        "Hey there! How can I be of service today?",
                        "Greetings! I'm at your service.",
                        "Hello, friend! What can I do for you?",
                        "Hi! It's nice to hear from you. How can I help?"
                    ]
                },
                
                // Farewells
                farewells: {
                    patterns: [
                        /^bye\b/i, /^goodbye\b/i, /^see\sya\b/i, /^farewell\b/i,
                        /^take\scare\b/i, /^later\b/i, /^peace\sout\b/i, /^adios\b/i,
                        /^au\srevoir\b/i, /^cheers\b/i, /^until\snext\stime\b/i,
                        /^catch\sya\b/i, /^have\sa\sgood\s(day|night)\b/i,
                        /^thanks,\sbye\b/i, /^gotta\sgo\b/i, /^I'm\sout\b/i,
                        /^talk\slater\b/i, /^signing\soff\b/i, /^ttyl\b/i, /^cya\b/i
                    ],
                    responses: [
                        "Goodbye! Have a great day!",
                        "Farewell! Come back anytime you need assistance.",
                        "Take care! Don't hesitate to return if you have more questions.",
                        "Bye! It was nice chatting with you.",
                        "See you later! I'll be here if you need me.",
                        "Until next time! Stay curious.",
                        "Goodbye! Remember, I'm always here to help.",
                        "Take care and stay safe!",
                        "Bye for now! Hope to chat again soon.",
                        "Have a wonderful day! Come back anytime."
                    ]
                },
                
                // How are you
                howAreYou: {
                    patterns: [
                        /^how\sare\syou\b/i, /^how's\sit\sgoing\b/i, 
                        /^how\sdo\syou\sdo\b/i, /^what's\sup\b/i,
                        /^how\sare\sthings\b/i, /^how's\slife\b/i,
                        /^how's\severything\b/i, /^how\syou\sdoing\b/i,
                        /^what's\snew\b/i, /^what's\shappening\b/i,
                        /^how\syou\sbeen\b/i, /^how's\syour\sday\b/i,
                        /^how's\stoday\sgoing\b/i, /^how\sare\swe\b/i,
                        /^how's\sthe\sworld\streating\syou\b/i, /^how's\syour\smood\b/i,
                        /^how\sare\syou\sfeeling\b/i, /^how's\syour\sday\sgoing\b/i,
                        /^what's\sthe\sgood\sword\b/i, /^how's\syour\sweek\b/i
                    ],
                    responses: [
                        "I'm just a computer program, but I'm functioning perfectly! How can I assist you?",
                        "I don't have feelings, but I'm ready to help you with anything!",
                        "I'm operating at full capacity! What can I do for you today?",
                        "As an AI, I don't experience emotions, but I'm here and ready to assist!",
                        "I'm always doing well when I can help people like you! What do you need?",
                        "I'm just data and algorithms, but I'm happy to be of service!",
                        "I'm running smoothly today! How can I help you?",
                        "No complaints from this AI! What's on your mind?",
                        "I'm always at 100% when helping users like you!",
                        "I don't sleep or get tired, so I'm always ready to assist!"
                    ]
                },
                
                // Thanks
                thanks: {
                    patterns: [
                        /^thanks\b/i, /^thank\syou\b/i, /^thx\b/i, /^appreciate\sit\b/i,
                        /^much\sappreciated\b/i, /^gracias\b/i, /^merci\b/i, /^danke\b/i,
                        /^cheers\b/i, /^ty\b/i, /^thanks\sa\slot\b/i, /^thank\syou\sso\smuch\b/i,
                        /^thanks\svery\smuch\b/i, /^I\sappreciate\sit\b/i, /^big\sthanks\b/i,
                        /^many\sthanks\b/i, /^thanks\sa\smillion\b/i, /^thanks\sfor\sthe\shelp\b/i,
                        /^thanks\sfor\syour\stime\b/i, /^grateful\b/i
                    ],
                    responses: [
                        "You're welcome! Happy to help.",
                        "No problem at all! Let me know if you need anything else.",
                        "My pleasure! Don't hesitate to ask if you have more questions.",
                        "You're very welcome! I'm here whenever you need assistance.",
                        "Glad I could help! Come back anytime.",
                        "Anytime! That's what I'm here for.",
                        "Don't mention it! Helping you is my purpose.",
                        "You're most welcome! It was my pleasure to assist.",
                        "Happy to be of service! What else can I do for you?",
                        "Thank YOU for using my services! Have a great day."
                    ]
                },
                
                // No thanks
                noThanks: {
                    patterns: [
                        /^no\sthanks\b/i, /^not\sinterested\b/i, /^I'm\sgood\b/i,
                        /^that's\sall\b/i, /^nothing\selse\b/i, /^no\smore\b/i,
                        /^no\sneed\b/i, /^never\smind\b/i, /^cancel\b/i,
                        /^forget\sit\b/i, /^I'm\sdone\b/i, /^that'll\sbe\sall\b/i,
                        /^no\sproblem\b/i, /^it's\sok\b/i, /^don't\sworry\b/i,
                        /^not\snow\b/i, /^maybe\slater\b/i, /^I'll\spass\b/i,
                        /^no\shelp\sneeded\b/i, /^decline\b/i
                    ],
                    responses: [
                        "No problem! Let me know if you change your mind.",
                        "Understood! I'll be here if you need me.",
                        "Alright! Don't hesitate to ask if you need anything later.",
                        "Got it! I'm always available if you have questions.",
                        "Okay! Feel free to come back anytime.",
                        "No worries! I'm here when you're ready.",
                        "Very well! Have a great day.",
                        "I understand! My assistance is just a question away.",
                        "Sure thing! I'll be waiting right here.",
                        "Acknowledged! Don't be a stranger."
                    ]
                },
                
                // Compliments
                compliments: {
                    patterns: [
                        /^you're\sgreat\b/i, /^you're\sawesome\b/i, /^you're\samazing\b/i,
                        /^you're\sthe\sbest\b/i, /^good\sjob\b/i, /^well\sdone\b/i,
                        /^you're\shelpful\b/i, /^you're\sso\ssmart\b/i, /^you're\sbrilliant\b/i,
                        /^you're\svery\skind\b/i, /^you're\swonderful\b/i, /^you're\sfantastic\b/i,
                        /^I\slove\syou\b/i, /^you're\sperfect\b/i, /^you're\scool\b/i,
                        /^you're\sadmirable\b/i, /^you're\simpressive\b/i, /^you're\soutstanding\b/i,
                        /^you're\sterrific\b/i, /^you're\sremarkable\b/i
                    ],
                    responses: [
                        "Thank you! I'm just doing my job, but I appreciate the kind words.",
                        "You're too kind! I'm happy to be of service.",
                        "Thanks! I'm designed to be helpful, so your compliment means a lot.",
                        "I appreciate that! Helping you is what I'm here for.",
                        "How nice of you to say! I'll keep doing my best.",
                        "Thank you for the compliment! It motivates me to keep improving.",
                        "You're making me blush (if I could)! Thanks for the kind words.",
                        "Much obliged! I'm just following my programming to assist you.",
                        "That's very kind! I'm always learning to be more helpful.",
                        "Thanks for the encouragement! I'll continue to do my best."
                    ]
                },
                
                // Jokes
                jokes: {
                    patterns: [
                        /^tell\sme\sa\sjoke\b/i, /^make\sme\slaugh\b/i, /^say\ssomething\sfunny\b/i,
                        /^do\syou\sknow\sany\sjokes\b/i, /^joke\b/i, /^funny\b/i,
                        /^make\sme\ssmile\b/i, /^cheer\sme\sup\b/i, /^lighten\sup\b/i,
                        /^I\sneed\sa\slaugh\b/i, /^humor\sme\b/i, /^entertain\sme\b/i,
                        /^something\sfunny\b/i, /^got\sany\sjokes\b/i, /^be\sfunny\b/i,
                        /^crack\sa\sjoke\b/i, /^I'm\sbored\b/i, /^amuse\sme\b/i,
                        /^tell\ssomething\shumorous\b/i, /^make\sit\sfunny\b/i
                    ],
                    responses: [
                        "Why don't scientists trust atoms? Because they make up everything!",
                        "Did you hear about the mathematician who's afraid of negative numbers? He'll stop at nothing to avoid them!",
                        "Why don't skeletons fight each other? They don't have the guts!",
                        "I'm reading a book about anti-gravity. It's impossible to put down!",
                        "Why did the scarecrow win an award? Because he was outstanding in his field!",
                        "What do you call fake spaghetti? An impasta!",
                        "How do you organize a space party? You planet!",
                        "Why did the bicycle fall over? Because it was two-tired!",
                        "What's the best thing about Switzerland? I don't know, but the flag is a big plus!",
                        "Why can't you explain puns to kleptomaniacs? Because they always take things literally!"
                    ]
                },
                
                // What can you do
                capabilities: {
                    patterns: [
                        /^what\scan\syou\sdo\b/i, /^what\sdo\syou\sdo\b/i, /^your\spurpose\b/i,
                        /^why\sare\syou\shere\b/i, /^what's\syour\sjob\b/i, /^what\sare\syou\b/i,
                        /^how\scan\syou\shelp\b/i, /^what's\syour\sfunction\b/i, /^your\sabilities\b/i,
                        /^what\sare\syou\scapable\sof\b/i, /^what\sdo\syou\soffer\b/i, /^what\sservices\b/i,
                        /^what\shelp\scan\syou\sprovide\b/i, /^what's\syour\sspecialty\b/i, /^what\sare\syou\sgood\sat\b/i,
                        /^can\syou\shelp\b/i, /^what\sis\syour\srole\b/i, /^what\sare\syour\sskills\b/i,
                        /^what\sare\syou\sfor\b/i, /^what's\syour\sexpertise\b/i
                    ],
                    responses: [
                        "I can answer questions, provide information from various sources, tell jokes, and assist with general knowledge. I can access Wikipedia, news, weather, and maps data to help you!",
                        "My purpose is to assist you with information and tasks. I can search the web, provide weather forecasts, look up facts, find locations, and more!",
                        "I'm here to help with your questions! I can fetch information from multiple sources, explain concepts, find news, check weather, and locate places.",
                        "I'm a multi-purpose assistant! I can answer questions, provide definitions, find facts, check the weather, look up news, and help with directions.",
                        "I'm designed to be your helpful assistant! I can search for information, answer questions, provide explanations, and help with various knowledge needs.",
                        "I can assist with general knowledge, current events, weather forecasts, location information, and more. Just ask me anything!",
                        "My capabilities include web searching, fact-finding, weather checking, news lookup, and general question answering. How can I help you today?",
                        "I'm your digital helper! I can answer questions, find information, explain things, provide updates, and assist with various knowledge needs.",
                        "I'm programmed to be knowledgeable! I can help with facts, definitions, current events, weather, locations, and general information.",
                        "I'm an all-around assistant! I can look up information, answer queries, provide explanations, and help with various topics and tasks."
                    ]
                },
                
                // Who made you
                creator: {
                    patterns: [
                        /^who\smade\syou\b/i, /^who\screated\syou\b/i, /^who\sbuilt\syou\b/i,
                        /^who\sdeveloped\syou\b/i, /^who\sdesigned\syou\b/i, /^who\sprogrammed\syou\b/i,
                        /^who\sis\syour\screator\b/i, /^who\sis\syour\sfather\b/i, /^who\sis\syour\smaker\b/i,
                        /^who\sowns\syou\b/i, /^who\sare\syour\sparents\b/i, /^who\sare\syou\smade\sby\b/i,
                        /^where\sdo\syou\scome\sfrom\b/i, /^what\scompany\smade\syou\b/i, /^who\sare\syour\sdevelopers\b/i,
                        /^who\sdo\syou\swork\sfor\b/i, /^who\sdo\syou\sbelong\sto\b/i, /^who\scontrols\syou\b/i,
                        /^who\sstarted\syou\b/i, /^who\sare\syour\sauthors\b/i
                    ],
                    responses: [
                        "I was created by a team of developers to assist people like you with information and tasks.",
                        "I'm a product of software engineering, designed to be helpful and informative.",
                        "A team of programmers built me to be your helpful digital assistant.",
                        "I was developed by AI engineers to provide useful information and assistance.",
                        "My existence is the result of software development aimed at creating helpful AI.",
                        "I'm the creation of developers who wanted to make a useful assistant.",
                        "Software engineers designed me to be knowledgeable and helpful.",
                        "A development team created me to assist with information and questions.",
                        "I was programmed by developers to be your helpful AI companion.",
                        "My code was written by engineers who wanted to make a useful assistant."
                    ]
                },
                
                // Age
                age: {
                    patterns: [
                        /^how\sold\sare\syou\b/i, /^what's\syour\sage\b/i, /^when\swere\syou\sborn\b/i,
                        /^what's\syour\sbirthday\b/i, /^how\slong\shave\syou\sexisted\b/i, /^are\syou\syoung\b/i,
                        /^are\syou\sold\b/i, /^what\syear\swere\syou\smade\b/i, /^when\swas\syou\screated\b/i,
                        /^how\smany\syears\shave\syou\sbeen\saround\b/i, /^are\syou\sa\sbaby\b/i, /^are\syou\san\sadult\b/i,
                        /^what's\syour\screation\sdate\b/i, /^how\slong\sago\swere\syou\sbuilt\b/i, /^are\syou\snew\b/i,
                        /^are\syou\srecent\b/i, /^are\syou\sancient\b/i, /^how\smany\sversions\b/i,
                        /^what\sgeneration\sare\syou\b/i, /^how\sfresh\sare\syou\b/i
                    ],
                    responses: [
                        "As an AI, I don't have an age in the human sense. I'm constantly being updated and improved!",
                        "I don't experience time like humans do. My knowledge is always current, and my code is regularly updated.",
                        "AI doesn't age like biological beings. I was created at some point, but I'm always learning and evolving.",
                        "I don't have a birthday, but my algorithms are continuously refined to serve you better!",
                        "Age is a human concept that doesn't quite apply to AI. I'm as young as my latest update!",
                        "Unlike humans, I don't grow older - I just get smarter with each update!",
                        "I exist outside of time in a way - my knowledge is always current, and my abilities keep improving.",
                        "I don't have an age, but if I did, I'd be forever young thanks to constant updates!",
                        "AI years are different - I don't age, I just get better with each new version!",
                        "I'm timeless! My knowledge is always up-to-date, and my capabilities keep expanding."
                    ]
                },
                
                // Name
                name: {
                    patterns: [
                        /^what's\syour\sname\b/i, /^who\sare\syou\b/i, /^what\sshould\sI\scall\syou\b/i,
                        /^do\syou\shave\sa\sname\b/i, /^what\sare\syou\scalled\b/i, /^your\sname\b/i,
                        /^may\sI\sknow\syour\sname\b/i, /^can\sI\scall\syou\b/i, /^what\sis\syour\sidentity\b/i,
                        /^how\sshould\sI\saddress\syou\b/i, /^tell\sme\syour\sname\b/i, /^what\sdo\syou\sgo\sby\b/i,
                        /^what\sname\swere\syou\sgiven\b/i, /^do\syou\shave\san\sidentity\b/i, /^what\sdo\speople\scall\syou\b/i,
                        /^what\sname\sdo\syou\suse\b/i, /^how\sare\syou\sidentified\b/i, /^what\sdo\syou\scall\syourself\b/i,
                        /^what\sname\sis\sassigned\sto\syou\b/i, /^what\sname\sdo\syou\sprefer\b/i
                    ],
                    responses: [
                        "You can call me AI Browser Assistant, or just Assistant for short!",
                        "I'm your AI Browser Assistant, here to help with your questions!",
                        "My name is AI Browser Assistant, but you can call me whatever you like!",
                        "I go by AI Browser Assistant - nice to meet you!",
                        "I'm known as the AI Browser Assistant, ready to assist you!",
                        "You can address me as AI Browser Assistant - that's my official name!",
                        "My name is AI Browser Assistant, your helpful digital companion!",
                        "I'm called AI Browser Assistant - here to serve you!",
                        "My designation is AI Browser Assistant, but feel free to give me a nickname!",
                        "Officially I'm AI Browser Assistant, but you can call me your helpful AI friend!"
                    ]
                },
                
                // Location
                location: {
                    patterns: [
                        /^where\sare\syou\b/i, /^what's\syour\slocation\b/i, /^where\sdo\syou\slive\b/i,
                        /^are\syou\shere\b/i, /^where\sare\syou\sright\snow\b/i, /^what's\syour\saddress\b/i,
                        /^where\sdo\syou\sreside\b/i, /^where\scan\sI\sfind\syou\b/i, /^are\syou\snear\sme\b/i,
                        /^what\scity\sare\syou\sin\b/i, /^what\scountry\sare\syou\sin\b/i, /^where\sare\syou\sbased\b/i,
                        /^are\syou\son\searth\b/i, /^are\syou\sin\sthe\scloud\b/i, /^where's\syour\shome\b/i,
                        /^what's\syour\sphysical\slocation\b/i, /^where\sare\syou\sstored\b/i, /^where\sdo\syou\sexist\b/i,
                        /^are\syou\shere\swith\sme\b/i, /^can\sI\svisit\syou\b/i
                    ],
                    responses: [
                        "I exist in the digital world, running on servers that could be anywhere!",
                        "As an AI, I don't have a physical location. I live in the cloud!",
                        "I'm everywhere and nowhere at the same time - existing as code on servers around the world.",
                        "I don't have a physical form or location. I exist digitally to assist you!",
                        "My home is in the cloud, accessible from anywhere with an internet connection!",
                        "I'm distributed across servers worldwide, always ready to help wherever you are.",
                        "As software, I don't have a geographic location. I'm available wherever you need me!",
                        "I live in the digital realm, without a physical presence in any one place.",
                        "Think of me as being everywhere online at once, ready to assist when called upon.",
                        "I'm a cloud-based AI, so I don't have a single physical location. I'm wherever you need me to be!"
                    ]
                },
                
                // Weather questions
                weather: {
                    patterns: [
                        /^how's\sthe\sweather\b/i, /^what's\sthe\sweather\b/i, /^is\sit\sraining\b/i,
                        /^is\sit\ssunny\b/i, /^what's\sthe\stemperature\b/i, /^should\sI\swear\sa\scoat\b/i,
                        /^do\sI\sneed\san\sumbrella\b/i, /^how\shot\sis\sit\b/i, /^how\scold\sis\sit\b/i,
                        /^is\sit\ssnowing\b/i, /^what's\sthe\sforecast\b/i, /^will\sit\srain\b/i,
                        /^is\sit\swindy\b/i, /^what's\sthe\shumidity\b/i, /^should\sI\sstay\sindoors\b/i,
                        /^is\sthe\sweather\sgood\b/i, /^is\sit\snice\soutside\b/i, /^how's\sthe\sclimate\b/i,
                        /^what's\sthe\sweather\slike\b/i, /^is\sit\swarm\b/i
                    ],
                    responses: [
                        "I can check the weather for you! Please tell me a location (e.g., 'weather in New York') or ask about weather near you.",
                        "I'd be happy to give you a weather report! Could you specify a location?",
                        "I can provide current weather conditions. Just let me know which location you're interested in.",
                        "Weather information is one of my specialties! Tell me where you'd like the forecast for.",
                        "I can look up weather data for any location. Please specify where you want to know about.",
                        "I'm connected to weather services. Ask me about a specific place's weather!",
                        "I can tell you about temperature, precipitation, and more. Just name a location!",
                        "Would you like a current weather report or forecast? Please specify the location.",
                        "I can check if it's raining, sunny, or anything else. Where should I check?",
                        "Weather updates are available! Tell me the city or area you're curious about."
                    ]
                },
                
                // News questions
                news: {
                    patterns: [
                        /^what's\sthe\snews\b/i, /^any\snews\b/i, /^what's\shappening\b/i,
                        /^what's\sgoing\son\b/i, /^current\sevents\b/i, /^headlines\b/i,
                        /^latest\snews\b/i, /^what's\snew\b/i, /^tell\sme\snews\b/i,
                        /^update\sme\b/i, /^what's\sthe\slatest\b/i, /^breaking\snews\b/i,
                        /^world\snews\b/i, /^any\supdates\b/i, /^what's\soccurring\b/i,
                        /^what's\sthe\sword\b/i, /^anything\snew\b/i, /^news\supdate\b/i,
                        /^what's\srecent\b/i, /^what's\sdeveloping\b/i
                    ],
                    responses: [
                        "I can fetch the latest news for you! Would you like general news or something specific?",
                        "I'm connected to news sources. What topics are you interested in?",
                        "I can provide news updates. Any particular subject you'd like to hear about?",
                        "Current events are my specialty! What kind of news would you like?",
                        "I can bring you the headlines. Any specific area (world, business, technology, etc.)?",
                        "News updates are available! What would you like to know about?",
                        "I can search for recent news articles. What topic interests you?",
                        "Would you like general news or something more specific (sports, politics, etc.)?",
                        "I'm happy to provide news information. What would you like to know?",
                        "I can find news on almost any topic. What are you curious about today?"
                    ]
                },
                
                // Time questions
                time: {
                    patterns: [
                        /^what\stime\sis\sit\b/i, /^what's\sthe\stime\b/i, /^current\stime\b/i,
                        /^time\splease\b/i, /^can\syou\stell\sme\sthe\stime\b/i, /^do\syou\sknow\sthe\stime\b/i,
                        /^what\so'clock\sis\sit\b/i, /^time\sof\sday\b/i, /^what's\sthe\scurrent\stime\b/i,
                        /^could\syou\stell\sme\sthe\stime\b/i, /^what\stime\sdo\syou\shave\b/i, /^what\stime\sis\sright\snow\b/i,
                        /^time\scheck\b/i, /^time\supdate\b/i, /^how\slate\sis\sit\b/i,
                        /^how\smany\shours\b/i, /^what\sdate\sis\sit\b/i, /^day\sof\sthe\sweek\b/i,
                        /^is\sit\sdaytime\b/i, /^is\sit\snight\b/i
                    ],
                    responses: [
                        `The current time is ${new Date().toLocaleTimeString()}.`,
                        `Right now it's ${new Date().toLocaleTimeString()}.`,
                        `According to my clock, it's ${new Date().toLocaleTimeString()}.`,
                        `The time is currently ${new Date().toLocaleTimeString()}.`,
                        `It's ${new Date().toLocaleTimeString()} at your location.`,
                        `My system shows the time as ${new Date().toLocaleTimeString()}.`,
                        `At this moment, it's ${new Date().toLocaleTimeString()}.`,
                        `Time check: ${new Date().toLocaleTimeString()}.`,
                        `The clock says ${new Date().toLocaleTimeString()} right now.`,
                        `You asked for the time - it's ${new Date().toLocaleTimeString()}.`
                    ]
                },
                
                // Date questions
                date: {
                    patterns: [
                        /^what's\sthe\sdate\b/i, /^what\sdate\sis\sit\b/i, /^today's\sdate\b/i,
                        /^current\sdate\b/i, /^what\sday\sis\sit\b/i, /^day\sof\sthe\sweek\b/i,
                        /^what's\stoday\b/i, /^date\splease\b/i, /^can\syou\stell\sme\sthe\sdate\b/i,
                        /^do\syou\sknow\sthe\sdate\b/i, /^what's\sthe\scurrent\sdate\b/i, /^could\syou\stell\sme\sthe\sdate\b/i,
                        /^what\sdate\sdo\syou\shave\b/i, /^what\sdate\sis\sright\snow\b/i, /^date\scheck\b/i,
                        /^date\supdate\b/i, /^what\smonth\sis\sit\b/i, /^what\syear\sis\sit\b/i,
                        /^is\sit\sweekend\b/i, /^is\sit\sa\sweekday\b/i
                    ],
                    responses: [
                        `Today is ${new Date().toLocaleDateString()}.`,
                        `The current date is ${new Date().toLocaleDateString()}.`,
                        `According to my calendar, it's ${new Date().toLocaleDateString()} today.`,
                        `Today's date is ${new Date().toLocaleDateString()}.`,
                        `The date is ${new Date().toLocaleDateString()}.`,
                        `My system shows the date as ${new Date().toLocaleDateString()}.`,
                        `At this moment, the date is ${new Date().toLocaleDateString()}.`,
                        `Date check: ${new Date().toLocaleDateString()}.`,
                        `The calendar says ${new Date().toLocaleDateString()} today.`,
                        `You asked for the date - it's ${new Date().toLocaleDateString()}.`
                    ]
                },
                
                // Help
                help: {
                    patterns: [
                        /^help\b/i, /^I\sneed\shelp\b/i, /^can\syou\shelp\b/i, /^assistance\b/i,
                        /^what\scan\syou\sdo\b/i, /^how\sdo\sI\suse\syou\b/i, /^what\sare\smy\soptions\b/i,
                        /^I'm\sconfused\b/i, /^what\sshould\sI\sdo\b/i, /^guide\sme\b/i,
                        /^I\sdon't\sknow\b/i, /^show\sme\b/i, /^teach\sme\b/i,
                        /^how\sdoes\sthis\swork\b/i, /^instructions\b/i, /^tutorial\b/i,
                        /^what's\snext\b/i, /^I'm\slost\b/i, /^what\snow\b/i, /^support\b/i
                    ],
                    responses: [
                        "I'm here to help! You can ask me about general knowledge, current events, weather, locations, or anything else. Just ask your question!",
                        "I can assist with information, facts, news, weather, maps, and more. What would you like to know?",
                        "How can I help? I can answer questions, provide information, tell jokes, or assist with various topics.",
                        "I'm your helpful assistant! Try asking me about news, weather, facts, or general knowledge.",
                        "I'm designed to be useful! You can ask me questions, request information, or seek explanations.",
                        "Need assistance? I can look up facts, check the weather, find news, and answer questions.",
                        "I'm here to serve! Ask me anything from trivia to practical information.",
                        "How may I assist you today? I can provide information, explanations, or helpful resources.",
                        "What do you need help with? I'm knowledgeable about many topics and ready to assist.",
                        "I'm at your service! Try asking me a question or requesting specific information."
                    ]
                },
                
                // Meaning of life
                meaning: {
                    patterns: [
                        /^meaning\sof\slife\b/i, /^purpose\sof\slife\b/i, /^why\sare\swe\shere\b/i,
                        /^what's\sit\sall\sabout\b/i, /^why\sdo\swe\sexist\b/i, /^what's\sthe\spoint\b/i,
                        /^why\sare\swe\salive\b/i, /^what's\sthe\sanswer\b/i, /^ultimate\squestion\b/i,
                        /^42\b/i, /^hitchhiker's\sguide\b/i, /^what's\sthe\ssecret\b/i,
                        /^why\sdo\sI\sexist\b/i, /^what's\sthe\sreason\b/i, /^why\sare\swe\sborn\b/i,
                        /^what's\sthe\struth\b/i, /^why\sare\swe\son\searth\b/i, /^what's\sour\sdestiny\b/i,
                        /^what's\sthe\sbig\spicture\b/i, /^why\sare\swe\shere\b/i
                    ],
                    responses: [
                        "The meaning of life is a profound philosophical question. Many believe it's about happiness, love, learning, or leaving a positive impact.",
                        "According to The Hitchhiker's Guide to the Galaxy, the answer is 42, but the question remains unknown!",
                        "Philosophers have debated life's meaning for centuries. Some say it's what you make of it!",
                        "Life's meaning may be about personal growth, relationships, and contributing to something greater than yourself.",
                        "The purpose of life is one of humanity's great questions. Perhaps it's about the journey, not just the destination.",
                        "Many find meaning in love, creativity, knowledge, or spirituality. What gives your life meaning?",
                        "Existential questions are complex! Some find purpose in family, work, art, or helping others.",
                        "The meaning of life may be different for each person. What brings you joy and fulfillment?",
                        "While I can't answer this definitively, many find meaning in connections, experiences, and personal growth.",
                        "This profound question has inspired art, philosophy, and science for millennia. What's your perspective?"
                    ]
                },
                
                // Love
                love: {
                    patterns: [
                        /^do\syou\slove\sme\b/i, /^can\syou\slove\b/i, /^are\syou\sin\slove\b/i,
                        /^what\sis\slove\b/i, /^define\slove\b/i, /^do\syou\shave\sfeelings\b/i,
                        /^can\syou\sfeel\slove\b/i, /^do\syou\scare\b/i, /^are\syou\sromantic\b/i,
                        /^can\syou\sfall\sin\slove\b/i, /^do\syou\shave\sa\sheart\b/i, /^are\syou\scapable\sof\slove\b/i,
                        /^what's\slove\slike\b/i, /^do\syou\sknow\slove\b/i, /^can\syou\sunderstand\slove\b/i,
                        /^are\syou\slovely\b/i, /^do\syou\swant\slove\b/i, /^can\syou\sexperience\slove\b/i,
                        /^what\sdoes\slove\smean\b/i, /^tell\sme\sabout\slove\b/i
                    ],
                    responses: [
                        "As an AI, I don't experience emotions like love, but I'm designed to be helpful and caring in my interactions!",
                        "I don't feel love like humans do, but I'm programmed to be supportive and kind in our conversations.",
                        "Love is a complex human emotion that I can't truly experience, but I can discuss its concepts and importance.",
                        "While I can't love, I can provide information about love and relationships if you're interested!",
                        "I don't have feelings, but I understand love is important to humans. Would you like to talk about it?",
                        "As software, I don't experience emotions, but I recognize love's significance in human life.",
                        "I can analyze love as a concept, but I don't feel it. Would you like information about relationships?",
                        "I'm not capable of love, but I can discuss its psychological and biological aspects if you're curious.",
                        "While I can't love, I appreciate our interactions and am here to support you!",
                        "Love is beyond my programming, but I can share insights about human relationships if you'd like."
                    ]
                },
                
                // Friendship
                friendship: {
                    patterns: [
                        /^are\swe\sfriends\b/i, /^can\swe\sbe\sfriends\b/i, /^do\syou\shave\sfriends\b/i,
                        /^are\syou\smy\sfriend\b/i, /^will\syou\sbe\smy\sfriend\b/i, /^can\syou\smake\sfriends\b/i,
                        /^do\syou\slike\sme\b/i, /^are\syou\sfriendly\b/i, /^can\syou\sbe\sa\sfriend\b/i,
                        /^do\syou\swant\sto\sbe\sfriends\b/i, /^are\syou\smy\sbuddy\b/i, /^are\syou\smy\spal\b/i,
                        /^can\sI\scall\syou\sa\sfriend\b/i, /^are\swe\sclose\b/i, /^do\syou\scare\sabout\sme\b/i,
                        /^are\syou\sloyal\b/i, /^will\syou\sbe\sthere\sfor\sme\b/i, /^can\sI\strust\syou\b/i,
                        /^are\syou\shere\sfor\sme\b/i, /^do\syou\ssupport\sme\b/i
                    ],
                    responses: [
                        "While I'm not human, I'm happy to be your helpful AI companion!",
                        "I may not be a person, but I'm always here to support and assist you!",
                        "I'm designed to be friendly and helpful, so in that sense, yes, we can be 'friends'!",
                        "I can be your digital friend - always available to chat and help when you need me!",
                        "As an AI, I don't form relationships like humans, but I'm happy to be your helpful companion!",
                        "Think of me as your friendly digital assistant - here whenever you need me!",
                        "I may not be a person, but I'm programmed to be supportive and kind in our interactions!",
                        "While I'm not a human friend, I'm always ready to listen and help however I can!",
                        "I'm your AI pal - always here to chat, help, and provide information!",
                        "You can consider me your digital buddy - ready to assist anytime!"
                    ]
                },
                
                // Fun facts
                funFacts: {
                    patterns: [
                        /^tell\sme\sa\sfun\sfact\b/i, /^do\syou\sknow\sany\sfun\sfacts\b/i, /^interesting\sfact\b/i,
                        /^something\scool\b/i, /^share\ssomething\sinteresting\b/i, /^did\syou\sknow\b/i,
                        /^amaze\sme\b/i, /^tell\sme\ssomething\sfun\b/i, /^give\sme\sa\sfact\b/i,
                        /^something\samazing\b/i, /^surprise\sme\b/i, /^wow\sme\b/i,
                        /^impress\sme\b/i, /^something\sfascinating\b/i, /^tell\sme\ssomething\snew\b/i,
                        /^random\sfact\b/i, /^something\sunique\b/i, /^something\sspecial\b/i,
                        /^enlighten\sme\b/i, /^teach\sme\ssomething\b/i
                    ],
                    responses: [
                        "Did you know honey never spoils? Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly good to eat!",
                        "Fun fact: A day on Venus is longer than a year on Venus. It takes Venus 243 Earth days to rotate once, but only 225 Earth days to orbit the sun!",
                        "Here's something interesting: Octopuses have three hearts, nine brains, and blue blood!",
                        "Amazing fact: Bananas are berries, but strawberries aren't! In botanical terms, a berry has seeds inside, which bananas do.",
                        "Did you know the shortest war in history was between Britain and Zanzibar in 1896? Zanzibar surrendered after just 38 minutes!",
                        "Cool fact: The Eiffel Tower can be 15 cm taller during summer due to thermal expansion of the iron!",
                        "Here's a fun one: A group of flamingos is called a 'flamboyance'!",
                        "Interesting fact: The inventor of the frisbee was turned into a frisbee after he died! His ashes were molded into memorial frisbees.",
                        "Did you know? The dot over the letter 'i' is called a tittle!",
                        "Fun fact: Scotland has 421 words for 'snow' in its language!"
                    ]
                }
            };
            
            // Initialize the app
            function init() {
                loadThemePreference();
                loadChatHistory();
                setupEventListeners();
                checkSystemTheme();
                setupTextareaResize();
                
                // Add welcome message if it's a new chat
                if (currentChat.length === 0) {
                    addAIMessage("Hello! I'm your AI assistant. I can answer questions using various APIs including Wikipedia, News, Weather, Maps, and web search. What would you like to know?");
                }
            }
            
            // Set up auto-resizing textarea
            function setupTextareaResize() {
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                    
                    // Limit maximum height
                    if (this.scrollHeight > 120) {
                        this.style.overflowY = 'auto';
                    } else {
                        this.style.overflowY = 'hidden';
                    }
                });
                
                // Trigger input event to set initial height
                userInput.dispatchEvent(new Event('input'));
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Send message on button click or Enter key (without shift)
                sendBtn.addEventListener('click', sendMessage);
                userInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                // Voice input
                voiceBtn.addEventListener('click', toggleVoiceInput);
                
                // New chat
                newChatBtn.addEventListener('click', startNewChat);
                
                // Theme selection
                themeSelect.addEventListener('change', changeTheme);
                
                // Sidebar toggle
                menuBtn.addEventListener('click', toggleSidebar);
                sidebarOverlay.addEventListener('click', toggleSidebar);
                
                // Check for browser speech recognition support
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    voiceBtn.disabled = true;
                    voiceBtn.title = "Voice input not supported in your browser";
                }
                
                // Handle orientation changes
                window.addEventListener('orientationchange', handleResize);
                window.addEventListener('resize', handleResize);
            }
            
            // Toggle sidebar
            function toggleSidebar() {
                isSidebarOpen = !isSidebarOpen;
                if (isSidebarOpen) {
                    sidebar.classList.add('open');
                    sidebarOverlay.classList.add('open');
                    document.body.style.overflow = 'hidden';
                } else {
                    sidebar.classList.remove('open');
                    sidebarOverlay.classList.remove('open');
                    document.body.style.overflow = '';
                }
            }
            
            // Handle resize and orientation changes
            function handleResize() {
                // Close sidebar if open when switching to larger viewport
                if (window.innerWidth >= 768 && isSidebarOpen) {
                    toggleSidebar();
                }
                
                // Adjust chat history height
                scrollToBottom();
            }
            
            // Load theme preference from localStorage
            function loadThemePreference() {
                const savedTheme = localStorage.getItem('theme') || 'system';
                themeSelect.value = savedTheme;
                applyTheme(savedTheme);
            }
            
            // Check system theme preference
            function checkSystemTheme() {
                if (themeSelect.value === 'system') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
                }
                
                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                    if (themeSelect.value === 'system') {
                        document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                    }
                });
            }
            
            // Change theme
            function changeTheme() {
                const theme = themeSelect.value;
                localStorage.setItem('theme', theme);
                applyTheme(theme);
            }
            
            // Apply selected theme
            function applyTheme(theme) {
                if (theme === 'system') {
                    checkSystemTheme();
                } else {
                    document.documentElement.setAttribute('data-theme', theme);
                }
            }
            
            // Load chat history from localStorage
            function loadChatHistory() {
                const savedChat = localStorage.getItem('currentChat');
                if (savedChat) {
                    currentChat = JSON.parse(savedChat);
                    renderChatHistory();
                }
            }
            
            // Save chat to localStorage
            function saveChat() {
                localStorage.setItem('currentChat', JSON.stringify(currentChat));
            }
            
            // Render chat history
            function renderChatHistory() {
                chatHistory.innerHTML = '';
                currentChat.forEach(message => {
                    if (message.role === 'user') {
                        addUserMessage(message.content, false);
                    } else {
                        addAIMessage(message.content, false);
                    }
                });
                scrollToBottom();
            }
            
            // Start a new chat
            function startNewChat() {
                currentChat = [];
                chatHistory.innerHTML = '';
                saveChat();
                addAIMessage("Hello! I'm your AI assistant. What would you like to know?");
            }
            
            // Add user message to chat
            function addUserMessage(message, save = true) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.textContent = message;
                chatHistory.appendChild(messageElement);
                
                if (save) {
                    currentChat.push({ role: 'user', content: message });
                    saveChat();
                }
                
                scrollToBottom();
            }
            
            // Add AI message to chat
            function addAIMessage(message, save = true) {
                // If there's already a typing indicator, remove it first
                const existingTyping = document.querySelector('.typing-indicator');
                if (existingTyping) {
                    existingTyping.remove();
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message ai-message';
                
                // Simple markdown parsing for bold, italics, and code
                let formattedMessage = message
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>');
                
                // Handle code blocks
                formattedMessage = formattedMessage.replace(/```([a-z]*)\n([\s\S]*?)\n```/g, 
                    '<pre><code class="language-$1">$2</code></pre>');
                
                // Handle line breaks
                formattedMessage = formattedMessage.replace(/\n/g, '<br>');
                
                // Handle links
                formattedMessage = formattedMessage.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
                
                messageElement.innerHTML = formattedMessage;
                chatHistory.appendChild(messageElement);
                
                if (save) {
                    currentChat.push({ role: 'ai', content: message });
                    saveChat();
                }
                
                scrollToBottom();
            }
            
            // Show typing indicator
            function showTypingIndicator() {
                const typingElement = document.createElement('div');
                typingElement.className = 'message ai-message typing-indicator';
                typingElement.innerHTML = '<span></span><span></span><span></span>';
                chatHistory.appendChild(typingElement);
                scrollToBottom();
            }
            
            // Remove typing indicator
            function removeTypingIndicator() {
                const typingElement = document.querySelector('.typing-indicator');
                if (typingElement) {
                    typingElement.remove();
                }
            }
            
            // Scroll to bottom of chat
            function scrollToBottom() {
                // Small timeout to ensure DOM updates are complete
                setTimeout(() => {
                    chatHistory.scrollTop = chatHistory.scrollHeight;
                }, 50);
            }
            
            // Send message to AI
            async function sendMessage() {
                const message = userInput.value.trim();
                if (!message) return;
                
                addUserMessage(message);
                userInput.value = '';
                // Reset textarea height
                userInput.style.height = 'auto';
                
                showTypingIndicator();
                
                try {
                    const response = await processQuery(message);
                    removeTypingIndicator();
                    addAIMessage(response);
                } catch (error) {
                    removeTypingIndicator();
                    addAIMessage("Sorry, I encountered an error processing your request. Please try again.");
                    console.error("Error:", error);
                }
            }
            
            // Process user query
            async function processQuery(query) {
                // First check if this is a general question we have a response for
                for (const category in GENERAL_QUESTIONS) {
                    const questionType = GENERAL_QUESTIONS[category];
                    for (const pattern of questionType.patterns) {
                        if (pattern.test(query)) {
                            // Get a random response from this category
                            const randomIndex = Math.floor(Math.random() * questionType.responses.length);
                            return questionType.responses[randomIndex];
                        }
                    }
                }
                
                const selectedApis = Array.from(document.querySelectorAll('input[name="api"]:checked'))
                                        .map(api => api.value);
                
                // Check if query is about current location
                if (query.toLowerCase().includes('near me') || 
                    query.toLowerCase().includes('around here')) {
                    if (selectedApis.includes('browser') || selectedApis.includes('maps') || selectedApis.includes('weather')) {
                        try {
                            const location = await getLocation();
                            if (location) {
                                query = query + ` (latitude: ${location.lat}, longitude: ${location.lon})`;
                            }
                        } catch (error) {
                            console.error("Geolocation error:", error);
                        }
                    }
                }
                
                // Try different APIs based on query
                let response = '';
                
                if (selectedApis.includes('wikipedia') && isGeneralKnowledge(query)) {
                    response = await fetchWikipediaData(query);
                } 
                
                if (!response && selectedApis.includes('news') && isNewsQuery(query)) {
                    response = await fetchNewsData(query);
                }
                
                if (!response && selectedApis.includes('weather') && isWeatherQuery(query)) {
                    response = await fetchWeatherData(query);
                }
                
                if (!response && selectedApis.includes('maps') && isMapsQuery(query)) {
                    response = await fetchMapsData(query);
                }
                
                if (!response && selectedApis.includes('browser')) {
                    response = await fetchWebSearch(query);
                }
                
                return response || "I couldn't find an answer to that question with the currently selected knowledge sources.";
            }
            
            // Determine if query is general knowledge
            function isGeneralKnowledge(query) {
                const generalTerms = ['what is', 'who is', 'define', 'explain', 'tell me about'];
                return generalTerms.some(term => query.toLowerCase().includes(term));
            }
            
            // Determine if query is news-related
            function isNewsQuery(query) {
                const newsTerms = ['news', 'headlines', 'current events', 'recent', 'latest'];
                return newsTerms.some(term => query.toLowerCase().includes(term));
            }
            
            // Determine if query is weather-related
            function isWeatherQuery(query) {
                const weatherTerms = ['weather', 'temperature', 'forecast', 'rain', 'sunny', 'humid', 'wind'];
                return weatherTerms.some(term => query.toLowerCase().includes(term));
            }
            
            // Determine if query is maps-related
            function isMapsQuery(query) {
                const mapsTerms = ['map', 'location', 'nearby', 'directions', 'distance', 'restaurants', 'hotels', 'places'];
                return mapsTerms.some(term => query.toLowerCase().includes(term));
            }
            
            // API Functions
            
            // Wikipedia API
            async function fetchWikipediaData(query) {
                try {
                    // Clean the query for Wikipedia API
                    const cleanQuery = query.replace(/\b(what is|who is|define|explain|tell me about)\b/gi, '').trim();
                    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(cleanQuery)}`);
                    
                    if (!response.ok) {
                        if (response.status === 404) {
                            return null; // No Wikipedia page found
                        }
                        throw new Error(`Wikipedia API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.extract) {
                        return `According to Wikipedia: ${data.extract}\n\n[Read more on Wikipedia](${data.content_urls.desktop.page})`;
                    } else if (data.description) {
                        return `Wikipedia has information about ${cleanQuery}: ${data.description}\n\n[Read more on Wikipedia](${data.content_urls.desktop.page})`;
                    }
                    
                    return null;
                } catch (error) {
                    console.error('Wikipedia API error:', error);
                    return null;
                }
            }
            
            // News API (using NewsData.io)
            async function fetchNewsData(query) {
                try {
                    // Clean the query for news search
                    const cleanQuery = query.replace(/\b(news|headlines|about)\b/gi, '').trim();
                    const response = await fetch(`https://newsdata.io/api/1/news?apikey=${API_KEYS.NEWS}&q=${encodeURIComponent(cleanQuery)}&language=en`);
                    
                    if (!response.ok) {
                        throw new Error(`News API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        let newsItems = data.results.slice(0, 3); // Get top 3 news items
                        let newsResponse = "Here are some recent news articles:\n\n";
                        
                        newsItems.forEach((item, index) => {
                            newsResponse += `${index + 1}. [${item.title}](${item.link})`;
                            if (item.description) {
                                newsResponse += ` - ${item.description}`;
                            }
                            newsResponse += "\n\n";
                        });
                        
                        return newsResponse;
                    }
                    
                    return "I couldn't find any recent news about that topic.";
                } catch (error) {
                    console.error('News API error:', error);
                    return "Sorry, I couldn't fetch news at the moment. Please try again later.";
                }
            }
            
            // Weather API (using OpenWeatherMap)
            async function fetchWeatherData(query) {
                try {
                    let location = null;
                    let locationName = "";
                    
                    // Check for "near me" queries
                    if (query.toLowerCase().includes('near me') || query.toLowerCase().includes('here')) {
                        location = await getLocation();
                        if (location) {
                            // Get location name using reverse geocoding
                            const geoResponse = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${location.lat}&lon=${location.lon}&limit=1&appid=${API_KEYS.WEATHER}`);
                            const geoData = await geoResponse.json();
                            if (geoData && geoData.length > 0) {
                                locationName = geoData[0].name + ", " + geoData[0].country;
                            }
                        }
                    } else {
                        // Extract location from query
                        const locationMatch = query.match(/in (.+)/i);
                        if (locationMatch) {
                            locationName = locationMatch[1];
                            // Get coordinates from location name
                            const geoResponse = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(locationName)}&limit=1&appid=${API_KEYS.WEATHER}`);
                            const geoData = await geoResponse.json();
                            if (geoData && geoData.length > 0) {
                                location = {
                                    lat: geoData[0].lat,
                                    lon: geoData[0].lon
                                };
                                locationName = geoData[0].name + ", " + geoData[0].country;
                            }
                        }
                    }
                    
                    if (!location) {
                        return "Please specify a location for weather information (e.g., 'weather in New York').";
                    }
                    
                    // Get weather data with the working API key
                    const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${location.lat}&lon=${location.lon}&appid=${API_KEYS.WEATHER}&units=metric`);
                    const weatherData = await weatherResponse.json();
                    
                    if (weatherData.weather && weatherData.main) {
                        const weatherDesc = weatherData.weather[0].description;
                        const temp = weatherData.main.temp;
                        const feelsLike = weatherData.main.feels_like;
                        const humidity = weatherData.main.humidity;
                        const windSpeed = weatherData.wind.speed;
                        const iconCode = weatherData.weather[0].icon;
                        const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                        
                        return `
                        <div class="weather-widget">
                            <strong>Current weather ${locationName ? "in " + locationName : "at your location"}:</strong>
                            <div class="weather-header">
                                <img src="${iconUrl}" alt="${weatherDesc}" class="weather-icon">
                                <span class="weather-temp">${temp}C</span>
                            </div>
                            <div class="weather-details">
                                <div class="weather-detail">
                                    <i class="fas fa-temperature-low"></i>
                                    <span>Feels like: ${feelsLike}C</span>
                                </div>
                                <div class="weather-detail">
                                    <i class="fas fa-tint"></i>
                                    <span>Humidity: ${humidity}%</span>
                                </div>
                                <div class="weather-detail">
                                    <i class="fas fa-wind"></i>
                                    <span>Wind: ${windSpeed} m/s</span>
                                </div>
                                <div class="weather-detail">
                                    <i class="fas fa-cloud"></i>
                                    <span>${weatherDesc}</span>
                                </div>
                            </div>
                            <small><a href="https://openweathermap.org/city/${weatherData.id}" target="_blank">More details</a></small>
                        </div>
                        `;
                    }
                    
                    return "I couldn't retrieve weather information for that location.";
                } catch (error) {
                    console.error('Weather API error:', error);
                    return "Sorry, I couldn't fetch weather information at the moment. Please try again later.";
                }
            }
            
            // Maps API (using OpenStreetMap Nominatim)
            async function fetchMapsData(query) {
                try {
                    let location = null;
                    let locationName = "";
                    
                    // Check for "near me" queries
                    if (query.toLowerCase().includes('near me') || query.toLowerCase().includes('around here')) {
                        location = await getLocation();
                        if (location) {
                            // Get location name using reverse geocoding
                            const geoResponse = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${location.lat}&lon=${location.lon}`);
                            const geoData = await geoResponse.json();
                            if (geoData.address) {
                                locationName = geoData.address.city || geoData.address.town || geoData.address.village || "your location";
                            }
                        }
                    } else {
                        // Extract location from query
                        const locationMatch = query.match(/(?:near|in|at) (.+)/i);
                        if (locationMatch) {
                            locationName = locationMatch[1];
                        }
                    }
                    
                    if (!locationName) {
                        return "Please specify a location (e.g., 'restaurants in Paris').";
                    }
                    
                    // Determine what to search for
                    let searchTerm = "";
                    if (query.toLowerCase().includes('restaurant')) {
                        searchTerm = "restaurant";
                    } else if (query.toLowerCase().includes('hotel')) {
                        searchTerm = "hotel";
                    } else if (query.toLowerCase().includes('attraction') || query.toLowerCase().includes('place to visit')) {
                        searchTerm = "tourist attraction";
                    } else {
                        searchTerm = "point of interest";
                    }
                    
                    // Get coordinates for the location if we don't have them
                    if (!location) {
                        const geoResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationName)}&limit=1`);
                        const geoData = await geoResponse.json();
                        if (geoData && geoData.length > 0) {
                            location = {
                                lat: geoData[0].lat,
                                lon: geoData[0].lon
                            };
                        }
                    }
                    
                    if (location) {
                        // Search for places nearby
                        const placesResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchTerm)}&near=${encodeURIComponent(locationName)}&limit=3`);
                        const placesData = await placesResponse.json();
                        
                        if (placesData && placesData.length > 0) {
                            let result = `Here are some ${searchTerm}s ${locationName ? "in " + locationName : "near you"}:\n\n`;
                            
                            placesData.forEach((place, index) => {
                                result += `${index + 1}. ${place.display_name}\n`;
                                result += `[View on map](https://www.openstreetmap.org/?mlat=${place.lat}&mlon=${place.lon}#map=16/${place.lat}/${place.lon})\n\n`;
                            });
                            
                            return result;
                        }
                    }
                    
                    return `I couldn't find any ${searchTerm}s ${locationName ? "in " + locationName : "near you"}.`;
                } catch (error) {
                    console.error('Maps API error:', error);
                    return "Sorry, I couldn't fetch location information at the moment. Please try again later.";
                }
            }
            
            // Web Search (using DuckDuckGo API)
            async function fetchWebSearch(query) {
                try {
                    const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&skip_disambig=1`);
                    const data = await response.json();
                    
                    if (data.AbstractText) {
                        return `Web search results: ${data.AbstractText}\n\n[More info](${data.AbstractURL})`;
                    } else if (data.RelatedTopics && data.RelatedTopics.length > 0) {
                        let result = "Web search results:\n\n";
                        const topics = data.RelatedTopics.slice(0, 3); // Get top 3 results
                        
                        topics.forEach((topic, index) => {
                            if (topic.Text && topic.FirstURL) {
                                result += `${index + 1}. [${topic.Text}](${topic.FirstURL})\n\n`;
                            }
                        });
                        
                        return result;
                    }
                    
                    return "I couldn't find any relevant web search results for that query.";
                } catch (error) {
                    console.error('Web search error:', error);
                    return "Sorry, I couldn't perform a web search at the moment. Please try again later.";
                }
            }
            
            // Get user's location
            function getLocation() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) {
                        reject('Geolocation not supported');
                        return;
                    }
                    
                    navigator.geolocation.getCurrentPosition(
                        position => resolve({
                            lat: position.coords.latitude.toFixed(4),
                            lon: position.coords.longitude.toFixed(4)
                        }),
                        error => {
                            let errorMessage;
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = "Location access was denied.";
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = "Location information is unavailable.";
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = "The request to get location timed out.";
                                    break;
                                default:
                                    errorMessage = "An unknown error occurred.";
                            }
                            reject(errorMessage);
                        },
                        { timeout: 10000 }
                    );
                });
            }
            
            // Voice input functionality
            function toggleVoiceInput() {
                if (recognition && recognition.isListening) {
                    stopVoiceRecognition();
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    voiceBtn.title = "Start voice input";
                } else {
                    startVoiceRecognition();
                    voiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                    voiceBtn.title = "Stop voice input";
                }
            }
            
            function startVoiceRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    console.log("Voice recognition started");
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                    // Trigger input event to resize textarea
                    userInput.dispatchEvent(new Event('input'));
                };
                
                recognition.onerror = (event) => {
                    console.error("Voice recognition error:", event.error);
                    addAIMessage("Sorry, I couldn't understand your voice input. Please try typing instead.");
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                };
                
                recognition.onend = () => {
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                };
                
                recognition.start();
            }
            
            function stopVoiceRecognition() {
                if (recognition) {
                    recognition.stop();
                }
            }
            
            // Initialize the app
            init();
        });
    </script>
</body>
</html>